<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8" />
  
  <title>第 6 页 | riusksk&#39;s blog</title>
  <meta name="author" content="riusksk" />

  

  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  
  <meta property="og:site_name" content="riusksk&#39;s blog" />

  
  

  
    <meta property="og:image" content="undefined" />
  

  
  <link href="/css/images/favicon.ico" rel="icon" />
  

  <link rel="alternate" href="/atom.xml" title="riusksk&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-78773323-1', 'auto');
	ga('send', 'pageview');

</script>



  <!-- baidu webmaster push -->
  <script src='//push.zhanzhang.baidu.com/push.js'></script>

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">riusksk&#39;s blog</a></h1>
  <h2><a href="/">攀蟾折桂摄寰宇，摘星揽月御乾坤。踏云踩雾骋宵壤，驱风逐日闯天地。 ------泉哥</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">主页</a></li>
    
      <li><a href="/archives">归档</a></li>
    
      <li><a href="/atom.xml">RSS订阅</a></li>
    
      <li><a href="/about">关于</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-01-21T11:55:08.000Z"><a href="/2018/01/21/2017年刷过的CVE/">2018-01-21</a></time>
      
      
  
    <h1 class="title"><a href="/2018/01/21/2017年刷过的CVE/">2017年刷过的CVE</a></h1>
  

    </header>
    <div class="entry">
      
        <table>
<thead>
<tr>
<th style="text-align:center">序号</th>
<th style="text-align:center">公司</th>
<th style="text-align:center">产品</th>
<th style="text-align:center">时间</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">CVE号</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Acrobat Reader</td>
<td style="text-align:center">2017/02/16</td>
<td style="text-align:center">Heap Overflow</td>
<td style="text-align:center">CVE-2017-2959</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">Foxit</td>
<td style="text-align:center">Foxit Reader</td>
<td style="text-align:center">2017/03/02</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-5989</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">Apple</td>
<td style="text-align:center">macOS/iOS</td>
<td style="text-align:center">2017/03/28</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-2407</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">Apple</td>
<td style="text-align:center">macOS/iOS</td>
<td style="text-align:center">2017/03/28</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-2406</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">Apple</td>
<td style="text-align:center">macOS/iOS</td>
<td style="text-align:center">2017/03/28</td>
<td style="text-align:center">Out-of-Bounds</td>
<td style="text-align:center">CVE-2017-2487</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">Apple</td>
<td style="text-align:center">macOS/iOS</td>
<td style="text-align:center">2017/03/28</td>
<td style="text-align:center">Denial of Service</td>
<td style="text-align:center">CVE-2017-2417</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center">Apple</td>
<td style="text-align:center">macOS/iOS</td>
<td style="text-align:center">2017/03/28</td>
<td style="text-align:center">Heap Overflow</td>
<td style="text-align:center">CVE-2017-2379</td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Acrobat Reader</td>
<td style="text-align:center">2017/04/12</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-3039</td>
</tr>
<tr>
<td style="text-align:center">9</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Acrobat Reader</td>
<td style="text-align:center">2017/04/12</td>
<td style="text-align:center">Out-of-Bounds</td>
<td style="text-align:center">CVE-2017-3040</td>
</tr>
<tr>
<td style="text-align:center">10</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Adobe Digital Editions</td>
<td style="text-align:center">2017/06/14</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-3096</td>
</tr>
<tr>
<td style="text-align:center">11</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Adobe Digital Editions</td>
<td style="text-align:center">2017/06/14</td>
<td style="text-align:center">Stack Overflow</td>
<td style="text-align:center">CVE-2017-3095</td>
</tr>
<tr>
<td style="text-align:center">12</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Adobe Digital Editions</td>
<td style="text-align:center">2017/06/14</td>
<td style="text-align:center">Stack Overflow</td>
<td style="text-align:center">CVE-2017-3094</td>
</tr>
<tr>
<td style="text-align:center">13</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Adobe Digital Editions</td>
<td style="text-align:center">2017/06/14</td>
<td style="text-align:center">Out-of-Bounds</td>
<td style="text-align:center">CVE-2017-3093</td>
</tr>
<tr>
<td style="text-align:center">14</td>
<td style="text-align:center">Apple</td>
<td style="text-align:center">macOS</td>
<td style="text-align:center">2017/07/20</td>
<td style="text-align:center">Stack Overflow</td>
<td style="text-align:center">CVE-2017-7033</td>
</tr>
<tr>
<td style="text-align:center">15</td>
<td style="text-align:center">Apple</td>
<td style="text-align:center">macOS</td>
<td style="text-align:center">2017/07/20</td>
<td style="text-align:center">Out-of-Bounds</td>
<td style="text-align:center">CVE-2017-7016</td>
</tr>
<tr>
<td style="text-align:center">16</td>
<td style="text-align:center">Apple</td>
<td style="text-align:center">macOS</td>
<td style="text-align:center">2017/07/20</td>
<td style="text-align:center">Out-of-Bounds</td>
<td style="text-align:center">CVE-2017-7015</td>
</tr>
<tr>
<td style="text-align:center">17</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Adobe Digital Editions</td>
<td style="text-align:center">2017/08/09</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-11280</td>
</tr>
<tr>
<td style="text-align:center">18</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Acrobat Reader</td>
<td style="text-align:center">2017/08/09</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-3016</td>
</tr>
<tr>
<td style="text-align:center">19</td>
<td style="text-align:center">Apple</td>
<td style="text-align:center">Xcode</td>
<td style="text-align:center">2017/09/20</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-7137</td>
</tr>
<tr>
<td style="text-align:center">20</td>
<td style="text-align:center">Apple</td>
<td style="text-align:center">Xcode</td>
<td style="text-align:center">2017/09/20</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-7136</td>
</tr>
<tr>
<td style="text-align:center">21</td>
<td style="text-align:center">Apple</td>
<td style="text-align:center">Xcode</td>
<td style="text-align:center">2017/09/20</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-7135</td>
</tr>
<tr>
<td style="text-align:center">22</td>
<td style="text-align:center">Apple</td>
<td style="text-align:center">Xcode</td>
<td style="text-align:center">2017/09/20</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-7134</td>
</tr>
<tr>
<td style="text-align:center">23</td>
<td style="text-align:center">Apple</td>
<td style="text-align:center">Xcode</td>
<td style="text-align:center">2017/09/20</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-7076</td>
</tr>
<tr>
<td style="text-align:center">24</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Adobe Digital Editions</td>
<td style="text-align:center">2017/11/15</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-11301</td>
</tr>
<tr>
<td style="text-align:center">25</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Acrobat Pro DC</td>
<td style="text-align:center">2017/11/15</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-16394</td>
</tr>
<tr>
<td style="text-align:center">26</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Acrobat Pro DC</td>
<td style="text-align:center">2017/11/15</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-16395</td>
</tr>
<tr>
<td style="text-align:center">27</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Acrobat Pro DC</td>
<td style="text-align:center">2017/11/15</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-16399</td>
</tr>
<tr>
<td style="text-align:center">28</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Acrobat Pro DC</td>
<td style="text-align:center">2017/11/15</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-16411</td>
</tr>
<tr>
<td style="text-align:center">29</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Acrobat Pro DC</td>
<td style="text-align:center">2017/11/15</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-16410</td>
</tr>
<tr>
<td style="text-align:center">30</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Acrobat Pro DC</td>
<td style="text-align:center">2017/11/15</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-16409</td>
</tr>
<tr>
<td style="text-align:center">31</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Acrobat Pro DC</td>
<td style="text-align:center">2017/11/15</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-16408</td>
</tr>
<tr>
<td style="text-align:center">32</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">Acrobat Pro DC</td>
<td style="text-align:center">2017/11/15</td>
<td style="text-align:center">Memory Corruption</td>
<td style="text-align:center">CVE-2017-11293</td>
</tr>
</tbody>
</table>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="/2018/01/21/2017年刷过的CVE/#comment" class="comment-link">评论</a>
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/技术分享/">技术分享</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/CVE/">CVE</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>

  </div>
</article>

<!-- 

 -->


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2017-06-04T08:37:20.000Z"><a href="/2017/06/04/调试V8中JS对应的汇编代码/">2017-06-04</a></time>
      
      
  
    <h1 class="title"><a href="/2017/06/04/调试V8中JS对应的汇编代码/">调试V8中JS对应的汇编代码</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="1、调试未优化代码"><a href="#1、调试未优化代码" class="headerlink" title="1、调试未优化代码"></a>1、调试未优化代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">gdb --args ~/v8/out/ia32.debug/d8 --print-code poc.js</span><br><span class="line">bp v8::internal::FullCodeGenerator::MakeCode</span><br><span class="line">run</span><br><span class="line">c</span><br><span class="line">finish   </span><br><span class="line">//跟c命令配对执行多次，直至打印出需要的汇编指令</span><br><span class="line">Run till exit from #0  v8::internal::FullCodeGenerator::MakeCode (info=0xff873eb8) at ../src/full-codegen.cc:283</span><br><span class="line">--- Raw source ---</span><br><span class="line">……</span><br><span class="line"></span><br><span class="line">--- Code ---</span><br><span class="line">source_position = 197</span><br><span class="line">kind = FUNCTION</span><br><span class="line">name = evil_object.toJSON</span><br><span class="line">Instructions (size = 128)</span><br><span class="line">0x2b3301a0     0  55             push ebp</span><br><span class="line">0x2b3301a1     1  89e5           mov ebp,esp</span><br><span class="line">……</span><br><span class="line">bp * 0x2b3301a0</span><br></pre></td></tr></table></figure>
<h3 id="2、调试优化代码"><a href="#2、调试优化代码" class="headerlink" title="2、调试优化代码"></a>2、调试优化代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">gef&gt;  bp v8::internal::Context::AddOptimizedFunctiongef&gt;  run Thread 1 &quot;d8&quot; hit Breakpoint 1, v8::internal::Context::AddOptimizedFunction (this=0x1fe2a1083a79, function=0x1fe2a10ac281) at ../src/contexts.cc:413gef&gt;  job function</span><br><span class="line"></span><br><span class="line">0x1fe2a10ac281: [Function]</span><br><span class="line"> - map = 0xe7a59804099 [FastProperties]</span><br><span class="line"> - prototype = 0x1fe2a1084069</span><br><span class="line"> - elements = 0x367f8ed82241 &lt;FixedArray[0]&gt; [FAST_HOLEY_ELEMENTS]</span><br><span class="line"> - initial_map = </span><br><span class="line"> - shared_info = 0x1fe2a10abdd9 &lt;SharedFunctionInfo Ctor&gt;</span><br><span class="line"> - name = 0x1fe2a10abae9 &lt;String[4]: Ctor&gt;</span><br><span class="line"> - formal_parameter_count = 0</span><br><span class="line"> - context = 0x1fe2a1083a79 &lt;FixedArray[188]&gt;</span><br><span class="line"> - literals = 0x1fe2a10ac551 &lt;FixedArray[1]&gt;</span><br><span class="line"> - </span><br><span class="line">code = 0x3e4da55066a1 &lt;Code: OPTIMIZED_FUNCTION&gt;</span><br><span class="line"> - properties = &#123;</span><br><span class="line">   #length: 0x367f8edd2709 &lt;AccessorInfo&gt; (accessor constant)</span><br><span class="line">   #name: 0x367f8edd2779 &lt;AccessorInfo&gt; (accessor constant)</span><br><span class="line">   #arguments: 0x367f8edd27e9 &lt;AccessorInfo&gt; (accessor constant)</span><br><span class="line">   #caller: 0x367f8edd2859 &lt;AccessorInfo&gt; (accessor constant)</span><br><span class="line">   #prototype: 0x367f8edd28c9 &lt;AccessorInfo&gt; (accessor constant)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">gef&gt; job 0x3e4da55066a1</span><br><span class="line">0x3e4da55066a1: [Code]</span><br><span class="line">kind = OPTIMIZED_FUNCTION</span><br><span class="line">stack_slots = 5</span><br><span class="line">compiler = crankshaft</span><br><span class="line">Instructions (size = 218)</span><br><span class="line">0x3e4da5506700     0  55             push rbp</span><br><span class="line">0x3e4da5506701     1  4889e5         REX.W movq rbp,rsp</span><br><span class="line">0x3e4da5506704     4  56             push rsi</span><br><span class="line">0x3e4da5506705     5  57             push rdi</span><br><span class="line">……</span><br><span class="line">gef&gt; bp *0x3e4da5506700</span><br><span class="line">gef&gt; c</span><br><span class="line"></span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Thread 1 &quot;d8&quot; hit Breakpoint 2, 0x00003e4da5506700 in ?? ()</span><br><span class="line">……</span><br><span class="line"> code:i386:x86-64</span><br><span class="line">0x3e4da5506700    push rbp   $pc</span><br><span class="line">0x3e4da5506701    mov rbp, rsp</span><br><span class="line">0x3e4da5506704    push rsi</span><br><span class="line">0x3e4da5506705    push rdi</span><br><span class="line">0x3e4da5506706    sub rsp, 0x8</span><br><span class="line">0x3e4da550670a    mov rax, QWORD PTR [rbp-0x8]</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="/2017/06/04/调试V8中JS对应的汇编代码/#comment" class="comment-link">评论</a>
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/技术分享/">技术分享</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/v8/">v8</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>

  </div>
</article>

<!-- 

 -->


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2017-02-26T06:27:31.000Z"><a href="/2017/02/26/0/">2017-02-26</a></time>
      
      
  
    <h1 class="title"><a href="/2017/02/26/0/">优秀作者</a></h1>
  

    </header>
    <div class="entry">
      
        <p>之前因为《漏洞战争：软件漏洞分析精要》一书的出版，获得电子工业出版社的“优秀作者”称号，感谢！</p>
<p><img src="http://riusksk.me/media/优秀作者.jpeg" alt=""></p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="/2017/02/26/0/#comment" class="comment-link">评论</a>
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/随笔杂谈/">随笔杂谈</a>
  </div>

        
        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>

  </div>
</article>

<!-- 

 -->


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-21T04:35:49.000Z"><a href="/2016/12/21/CVE-2016-7595/">2016-12-21</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/21/CVE-2016-7595/">CVE-2016-7595 Apple macOS/iOS CoreText OTL::GPOS::ApplyPairPos 越界访问漏洞分析</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>2016年12月的Apple安全公告中（<a href="https://support.apple.com/zh-cn/HT207423" target="_blank" rel="external">macOS公告</a>与<a href="https://support.apple.com/zh-cn/HT207422" target="_blank" rel="external">iOS公告</a>），修复4个由腾讯安全平台部终端安全团队报告的漏洞，其中有2个是字体解析造成的越界访问漏洞，影响 macOS/iOS/watchOS/tvOS等多个平台系统，本文主要分析其中的 CVE-2016-7595 字体漏洞【图1】。</p>
<center><br><img src="http://riusksk.me/media/14819500329936/14819504640098.jpg" alt=""><br>图1</center>

<p>这个漏洞在报给Apple 17天后发布 macOS 10.2.2 测试版补丁，一个半月后发布安全公告和补丁（包括iOS、watchOS和tvOS），难得看见苹果这么积极一次。</p>
<p>###漏洞分析<br>此次漏洞是通过Fuzzing发现的，直接对比poc与原始文件的数据，可以发现其实就1个字节的差异（0x00 =&gt; 0x6C）【图2】：</p>
<center><br><img src="http://riusksk.me/media/14819500329936/14819521265634.jpg" alt=""><br>图2</center>

<p>用ttx命令分析字体格式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">╭─riusksk@MacBook  ~/Downloads ‹›</span><br><span class="line">╰─➤$ ttx poc.ttf</span><br><span class="line">Dumping <span class="string">"poc.ttf"</span> to <span class="string">"poc#1.ttx"</span>...</span><br><span class="line">Dumping 'GlyphOrder' table...</span><br><span class="line">Dumping 'head' table...</span><br><span class="line">Dumping 'hhea' table...</span><br><span class="line">Dumping 'maxp' table...</span><br><span class="line">Dumping 'OS/2' table...</span><br><span class="line">Dumping 'hmtx' table...</span><br><span class="line">Dumping 'cmap' table...</span><br><span class="line">Dumping 'fpgm' table...</span><br><span class="line">Dumping 'prep' table...</span><br><span class="line">Dumping 'cvt ' table...</span><br><span class="line">Dumping 'loca' table...</span><br><span class="line">Dumping 'glyf' table...</span><br><span class="line">Dumping 'name' table...</span><br><span class="line">Dumping 'post' table...</span><br><span class="line">Dumping 'gasp' table...</span><br><span class="line">/usr/local/lib/python2<span class="number">.7</span>/site-packages/FontTools/fontTools/ttLib/tables/otTables.py:<span class="number">60</span>: UserWarning: Coverage table has start glyph ID out of range: glyph27713.</span><br><span class="line">  warnings.warn(<span class="string">"Coverage table has start glyph ID out of range: %s."</span> % start)</span><br><span class="line">An exception occurred during the decompilation of the 'GPOS' table</span><br><span class="line">Dumping 'GPOS' table...</span><br><span class="line">Dumping 'GSUB' table...</span><br><span class="line">Dumping 'DSIG' table...</span><br></pre></td></tr></table></figure>
<p>从上面的提示可以看出，是在解析<code>GPOS</code>表时，通过<code>glyphID</code>去<code>Coverage</code>表索引时导致越界了，其中<code>glyph27713</code>的数值正是<code>0x6C41（27713）</code>,也就是上面图1中文件对比的差异值。虽然这是FontTools工具的错误，不代表Apple系统本身，但它跟Apple系统导致崩溃的是同一字节，从这可以直接得到导致崩溃的关键字节是glyphID值。</p>
<h4 id="GPOS表"><a href="#GPOS表" class="headerlink" title="GPOS表"></a>GPOS表</h4><p>TrueType/OpenType字体格式中的GPOS表是用于为字体中文本布局及渲染提供glyph位置信息的表，表中各个字体结构如图3所示：</p>
<center><br><img src="http://riusksk.me/media/14819500329936/14819570625241.jpg" alt=""><br>图3</center>

<p>GPOS表主要包含3个子表：ScriptList、FeatureList和LookupList，本次漏洞主要问题在LookupList子表中的PairAdjustmentPositioning中，PairAdjustmentPositioning子表(PairPos)被用于调整两个glyphs彼此之间的位置。</p>
<p>PairPos表下又包含多个PairSet数组，PairSet数组包含Coverage表中每个glyph对应的偏移量，并按Coverage Index来排序。</p>
<p>PairSet下包含PairValueRecord指定每一glyph配对(pair)中的第二个glyph（SecondGlyph）的glyph名和索引值GlyphID（对应【图3】中glyphRefID），同时包含两个ValueRecord值去指定第一个glyph和第二个glyph的位置信息。</p>
<p>导致越界的漏洞正是用于索引的GlyphID（glyphRefID），用ttx解析原有正常字体文件生成的xml文件，如图4所示，index=”65”就是正常GlyphID值 00 41，如果随便给第1字节设置个值都会导致崩溃。</p>
<center><br><img src="http://riusksk.me/media/14819500329936/14819586010961.jpg" alt=""><br>图4</center>

<h4 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h4><p>用lldb调试下，崩溃后的地址及栈回溯如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">(lisa)run poc.ttf </span><br><span class="line">Process 96714 launched</span><br><span class="line">Process 96714 stopped</span><br><span class="line">* thread #1: tid = 0x3f119d, 0x00007fffa7c01491 CoreText`OTL::GPOS::ApplyPairPos(OTL::LookupSubtable const*, TGlyphIterator&amp;, OTL::Coverage const&amp;) const + 411, queue = &apos;com.apple.main-thread&apos;, stop reason = EXC_BAD_ACCESS (code=1, address=0x3007ddfae)</span><br><span class="line">  frame #0: 0x00007fffa7c01491 CoreText`OTL::GPOS::ApplyPairPos(OTL::LookupSubtable const*, TGlyphIterator&amp;, OTL::Coverage const&amp;) const + 411</span><br><span class="line">CoreText`OTL::GPOS::ApplyPairPos:</span><br><span class="line">-&gt;  0x7fffa7c01491 &lt;+411&gt;: mov    ax, word ptr [r14 + 2*rax + 0xa]</span><br><span class="line">  0x7fffa7c01497 &lt;+417&gt;: rol    ax, 0x8</span><br><span class="line">  0x7fffa7c0149b &lt;+421&gt;: movzx  eax, ax</span><br><span class="line">  0x7fffa7c0149e &lt;+424&gt;: lea    rsi, [r14 + rax]</span><br><span class="line">(lisa)register read rax</span><br><span class="line">   rax = 0x00000000ffffffff</span><br><span class="line">(lisa)x $r14+2*$rax+0xa</span><br><span class="line">error: memory read failed for 0x3007c5600</span><br><span class="line"></span><br><span class="line">(lisa)bt</span><br><span class="line">* thread #1: tid = 0x3f119d, 0x00007fffa7c01491 CoreText`OTL::GPOS::ApplyPairPos(OTL::LookupSubtable const*, TGlyphIterator&amp;, OTL::Coverage const&amp;) const + 411, queue = &apos;com.apple.main-thread&apos;, stop reason = EXC_BAD_ACCESS (code=1, address=0x3007ddfae)</span><br><span class="line">* frame #0: 0x00007fffa7c01491 CoreText`OTL::GPOS::ApplyPairPos(OTL::LookupSubtable const*, TGlyphIterator&amp;, OTL::Coverage const&amp;) const + 411</span><br><span class="line">  frame #1: 0x00007fffa7c05907 CoreText`OTL::GPOS::ApplyLookupSubtable(OTL::Lookup const&amp;, unsigned int, OTL::LookupSubtable const*, TGlyphIterator&amp;, OTL::Coverage const&amp;) const + 85</span><br><span class="line">  frame #2: 0x00007fffa7c02c7b CoreText`OTL::GPOS::ApplyLookupAt(OTL::Lookup const&amp;, TGlyphIterator&amp;) const + 339</span><br><span class="line">  frame #3: 0x00007fffa7b68ff4 CoreText`OTL::GPOS::ApplyLookups(TRunGlue&amp;, int, OTL::GlyphLookups&amp;) const + 448</span><br><span class="line">  frame #4: 0x00007fffa7b68897 CoreText`TOpenTypePositioningEngine::PositionRuns(SyncState&amp;, KerningStatus&amp;) + 839</span><br><span class="line">  frame #5: 0x00007fffa7b66d05 CoreText`TKerningEngine::PositionGlyphs(TLine&amp;, TCharStream const*) + 347</span><br><span class="line">  frame #6: 0x00007fffa7bbe59d CoreText`TTypesetter::FinishLayout(std::__1::tuple&lt;TLine const*, TCharStream const*, void const* (*)(__CTRun const*, __CFString const*, void*), void*, std::__1::shared_ptr&lt;TBidiLevelsProvider&gt;*, unsigned int, unsigned char&gt; const&amp;, TLine&amp;, SyncState) + 35</span><br><span class="line">  frame #7: 0x00007fffa7b5586d CoreText`TTypesetterAttrString::Initialize(__CFAttributedString const*) + 865</span><br><span class="line">  frame #8: 0x00007fffa7b552ea CoreText`CTLineCreateWithAttributedString + 59</span><br><span class="line">  frame #9: 0x00007fffb8be086e UIFoundation`__NSStringDrawingEngine + 10669</span><br><span class="line">  frame #10: 0x00007fffb8be69ca UIFoundation`-[NSAttributedString(NSExtendedStringDrawing) boundingRectWithSize:options:context:] + 605</span><br><span class="line">  frame #11: 0x00007fffb8bdcc43 UIFoundation`-[NSAttributedString(NSStringDrawing) size] + 59</span><br><span class="line">  frame #12: 0x0000000100047d70 Font Book`___lldb_unnamed_symbol1053$$Font Book + 368</span><br><span class="line">  frame #13: 0x00000001000476e9 Font Book`___lldb_unnamed_symbol1052$$Font Book + 89</span><br><span class="line">  frame #14: 0x00000001000475b0 Font Book`___lldb_unnamed_symbol1049$$Font Book + 774</span><br><span class="line">  frame #15: 0x000000010006a2d2 Font Book`___lldb_unnamed_symbol1860$$Font Book + 110</span><br><span class="line">  frame #16: 0x000000010005d4ee Font Book`___lldb_unnamed_symbol1545$$Font Book + 2651</span><br><span class="line">  frame #17: 0x00007fffa46b2451 AppKit`-[NSApplication _doOpenFile:ok:tryTemp:] + 253</span><br><span class="line">  frame #18: 0x00007fffa427f789 AppKit`-[NSApplication finishLaunching] + 1624</span><br><span class="line">  frame #19: 0x00007fffa427ed2a AppKit`-[NSApplication run] + 267</span><br><span class="line">  frame #20: 0x00007fffa4249a8a AppKit`NSApplicationMain + 1237</span><br><span class="line">  frame #21: 0x0000000100001527 Font Book`___lldb_unnamed_symbol1$$Font Book + 11</span><br><span class="line">  frame #22: 0x00007fffbb632255 libdyld.dylib`start + 1</span><br><span class="line">  frame #23: 0x00007fffbb632255 libdyld.dylib`start + 1</span><br></pre></td></tr></table></figure>
<p><code>[r14 + 2*rax + 0xa]</code>索引错误，很典型的数组越界指令。</p>
<p>通过设置条件断点去记录获取的GlyphID以及后面的将其传参给OTL::Coverage::SearchFmt2Binary函数后返回值，可以发现最后当GlyphID=0x55(85)时返回值0，最后触发崩溃，所以样本中的GlyphID只要&gt;=0x55都会导致崩溃。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(lisa) p <span class="string">"GlyphID"</span> $eax</span><br><span class="line">(<span class="keyword">unsigned</span> <span class="keyword">int</span>) $<span class="number">95</span> = <span class="number">85</span></span><br><span class="line">(lisa) c</span><br><span class="line">Process <span class="number">25648</span> resuming</span><br><span class="line">Command #<span class="number">2</span> <span class="string">'c'</span> continued the target.</span><br><span class="line">(lisa) p <span class="string">"SearchFmt2Binary参数2"</span> $esi</span><br><span class="line">(<span class="keyword">unsigned</span> <span class="keyword">int</span>) $<span class="number">96</span> = <span class="number">85</span></span><br><span class="line">(lisa) c</span><br><span class="line">Process <span class="number">25648</span> resuming</span><br><span class="line">Command #<span class="number">2</span> <span class="string">'c'</span> continued the target.</span><br><span class="line">(lisa) p <span class="string">"返回值"</span> $eax</span><br><span class="line">(<span class="keyword">unsigned</span> <span class="keyword">int</span>) $<span class="number">97</span> = <span class="number">0</span></span><br><span class="line">(lisa) c</span><br><span class="line">Process <span class="number">25648</span> resuming</span><br><span class="line">Command #<span class="number">2</span> <span class="string">'c'</span> continued the target.</span><br><span class="line">Process <span class="number">25648</span> stopped</span><br><span class="line">* thread #1: tid = 0x43fc6, 0x00007fffcb443491 CoreText`OTL::GPOS::ApplyPairPos(OTL::LookupSubtable const*, TGlyphIterator&amp;, OTL::Coverage const&amp;) const + 411, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x3007bc6fe)</span><br><span class="line">    frame #<span class="number">0</span>: <span class="number">0x00007fffcb443491</span> CoreText`OTL::GPOS::ApplyPairPos(OTL::LookupSubtable <span class="keyword">const</span>*, TGlyphIterator&amp;, OTL::Coverage <span class="keyword">const</span>&amp;) <span class="keyword">const</span> + <span class="number">411</span></span><br><span class="line">CoreText`OTL::GPOS::ApplyPairPos:</span><br><span class="line">-&gt;  <span class="number">0x7fffcb443491</span> &lt;+<span class="number">411</span>&gt;: mov    ax, word ptr [r14 + <span class="number">2</span>*rax + <span class="number">0xa</span>]</span><br><span class="line">    <span class="number">0x7fffcb443497</span> &lt;+<span class="number">417</span>&gt;: rol    ax, <span class="number">0x8</span></span><br><span class="line">    <span class="number">0x7fffcb44349b</span> &lt;+<span class="number">421</span>&gt;: movzx  eax, ax</span><br><span class="line">    <span class="number">0x7fffcb44349e</span> &lt;+<span class="number">424</span>&gt;: lea    rsi, [r14 + rax]</span><br></pre></td></tr></table></figure>
<p>返回值为0时，经dec减1后为0xFFFFFFFF，以此为索引值，最后导致越界访问。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dec     eax     ; eax=0xFFFFFFFF</span><br><span class="line">mov     ax, [r14+rax*2+0Ah] ; 越界访问，导致崩溃</span><br></pre></td></tr></table></figure>
<h3 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><p>苹果已经发布安全补丁，macOS用户可升级到10.12.2，iOS用户可升级到10.2。</p>
<p>对补丁进行比对，可以发现在漏洞函数OTL::GPOS::ApplyPairPos 中添加了判断【图5】，获取到的GlyphID值传递给OTL::Coverage::SearchFmt2Binary函数，当查找失败时会返回0，因此只要添加判断返回值是否为0，为0则直接跳走返回。</p>
<center><br><img src="http://riusksk.me/media/14819500329936/14820615589596.jpg" alt=""><br>图5</center>

<h3 id="处理流程"><a href="#处理流程" class="headerlink" title="处理流程"></a>处理流程</h3><ol>
<li>2016-10-23 通过邮件提交给Apple</li>
<li>2016-11-09 Apple确认漏洞，并在 macOS Sierra 10.12.2 beta 测试版中修复</li>
<li>2016-12-09 分配CVE号：CVE-2016-7595</li>
<li>2016-12-14 Apple发布安全公告，并推送补丁</li>
</ol>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="/2016/12/21/CVE-2016-7595/#comment" class="comment-link">评论</a>
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/技术分享/">技术分享</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/macOS/">macOS</a>, <a href="/tags/iOS/">iOS</a>, <a href="/tags/Apple/">Apple</a>, <a href="/tags/漏洞/">漏洞</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>

  </div>
</article>

<!-- 

 -->


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-17T08:32:03.000Z"><a href="/2016/12/17/2016年刷过的CVE/">2016-12-17</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/17/2016年刷过的CVE/">2016年刷过的CVE</a></h1>
  

    </header>
    <div class="entry">
      
        <p>今年也开始尝试跟风刷CVE，主要是下半年才开始搞，开始聚集Google和Apple，Google Android 因为撞洞，最终连个CVE也没有，也是惨，只能寄希望于2017年了。革命尚未成功，同志仍需努力！</p>
<table>
<thead>
<tr>
<th>公司</th>
<th>产品</th>
<th>时间</th>
<th>类型</th>
<th>CVE号</th>
</tr>
</thead>
<tbody>
<tr>
<td>/</td>
<td>libarchive</td>
<td>2016/12/29</td>
<td>Use After Free</td>
<td>CVE-2016-10080</td>
</tr>
<tr>
<td>Apple</td>
<td>macOS/iOS</td>
<td>2016/12/14</td>
<td>Out-of-Bounds</td>
<td>CVE-2016-7595</td>
</tr>
<tr>
<td>Apple</td>
<td>macOS/iOS</td>
<td>2016/12/14</td>
<td>Out-of-Bounds</td>
<td>CVE-2016-4691</td>
</tr>
<tr>
<td>Apple</td>
<td>macOS</td>
<td>2016/12/14</td>
<td>Memory Corruption</td>
<td>CVE-2016-7618</td>
</tr>
<tr>
<td>Apple</td>
<td>macOS</td>
<td>2016/12/14</td>
<td>Memory Corruption</td>
<td>CVE-2016-7622</td>
</tr>
<tr>
<td>/</td>
<td>giflib</td>
<td>2016/12/13</td>
<td>Out-of-Bounds</td>
<td>CVE-2016-9944</td>
</tr>
<tr>
<td>/</td>
<td>OpenJPEG</td>
<td>2016/12/07</td>
<td>Memory Corruption</td>
<td>CVE-2016-9890</td>
</tr>
<tr>
<td>/</td>
<td>libxml2</td>
<td>2016/12/05</td>
<td>Out-of-Bounds</td>
<td>CVE-2016-9833</td>
</tr>
<tr>
<td>/</td>
<td>OpenJPEG</td>
<td>2016/12/01</td>
<td>Memory Corruption</td>
<td>CVE-2016-9753</td>
</tr>
<tr>
<td>Apple</td>
<td>Mac OS X</td>
<td>2016/09/21</td>
<td>Memory Corruption</td>
<td>CVE-2016-4779</td>
</tr>
<tr>
<td>Apple</td>
<td>Xcode</td>
<td>2016/09/14</td>
<td>Memory Corruption</td>
<td>CVE-2016-4705</td>
</tr>
<tr>
<td>/</td>
<td>libgd</td>
<td>2016/05/01</td>
<td>Double Free</td>
<td>CVE-2016-4413</td>
</tr>
<tr>
<td>/</td>
<td>libav</td>
<td>2016/03/18</td>
<td>Memory Corruption</td>
<td>CVE-2016-3184</td>
</tr>
<tr>
<td>/</td>
<td>libav</td>
<td>2016/03/11</td>
<td>Memory Corruption</td>
<td>CVE-2016-3062</td>
</tr>
<tr>
<td>Adobe</td>
<td>Flash Player</td>
<td>2016/03/11</td>
<td>Memory Corruption</td>
<td>CVE-2016-0992</td>
</tr>
</tbody>
</table>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="/2016/12/17/2016年刷过的CVE/#comment" class="comment-link">评论</a>
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/技术分享/">技术分享</a>
  </div>

        
        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>

  </div>
</article>

<!-- 

 -->


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-25T06:42:47.000Z"><a href="/2016/09/25/BlackHat-USA-2016-议题分析/">2016-09-25</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/25/BlackHat-USA-2016-议题分析/">BlackHat USA 2016 议题分析</a></h1>
  

    </header>
    <div class="entry">
      
        <p>作者：riusksk（泉哥）<br>主页：<a href="http://riusksk.me" target="_blank" rel="external">http://riusksk.me</a><br>本文已发表于2016年9月CSDN的《程序员》杂志，转载请注明出处。</p>
<center><br><img src="http://riusksk.me/media/14710526596463/14713134215430.jpg" alt="">￼<br></center>

<h2 id="大会概述"><a href="#大会概述" class="headerlink" title="大会概述"></a>大会概述</h2><p>BlackHat USA 是世界上最著名的黑客大会BlackHat的主场，规模远超亚洲、欧洲等分会，今年大约有15000人参会，依然在美国拉斯维加斯举办。</p>
<p>大会全程共6天，包括 Training 培训、Keynote 议题分享、Arsenal 工具展示以及素有”黑客奥斯卡“之称的 Pwnie Awards 颁奖。</p>
<p>今年有上百个议题入选，涉及的安全领域也是相当广泛全面，包括移动安全、物联网、软件安全、加密、工控、企业安全、Web安全、逆向工程、恶意软件等等，整体上跟往年的议题类型差不多。</p>
<p>每年的BlackHat USA都代表着一个安全技术发展的”风向标“，在这可以看到全球顶端安全研究人员的研究成果，以及业界安全发展趋势。不少政府人员，比如FBI经常会出现在会场，以前也有FBI在现场带走一些有犯罪记录的人员，或者禁止涉及过于敏感内容的演讲，但一般是在BlackHat的兄弟会议Defcon上下手，比如曾经某黑客在Defcon演讲完后，在回旅馆的路上被抓了，还有之前MIT学生破解波士顿地铁免费乘坐地铁的演讲也被禁止掉。</p>
<h2 id="精彩议题分析"><a href="#精彩议题分析" class="headerlink" title="精彩议题分析"></a>精彩议题分析</h2><p>笔者针对BlackHat官网上公布的各个议题pdf筛选了一遍，挑选出一些大家可能感兴趣，或者技术新颖有兴趣的议题作简要介绍和点评。</p>
<h3 id="1、《Using-EMET-to-Disable-EMET》——绕过微软EMET防护工具实现软件漏洞利用的方法"><a href="#1、《Using-EMET-to-Disable-EMET》——绕过微软EMET防护工具实现软件漏洞利用的方法" class="headerlink" title="1、《Using EMET to Disable EMET》——绕过微软EMET防护工具实现软件漏洞利用的方法"></a>1、《Using EMET to Disable EMET》——绕过微软EMET防护工具实现软件漏洞利用的方法</h3><center><br><img src="http://riusksk.me/media/14710526596463/14711374846572.jpg" alt="">￼<br>图1：禁用EMET前后LoadLibraryA函数入口代码的对比情况<br></center>

<p>该议题来自国外著名安全公司FireEye的分享，是一家专门为企业提供安全防护产品的公司，该公司曾发现许多0Day漏洞以及APT攻击事件。</p>
<p><strong>【内容简介】</strong></p>
<p>Microsoft’s Enhanced Mitigation Experience Toolkit (EMET)是一款针对用户程序的内存防护工具，可以提高软件的漏洞利用难度。<br>FireEye安全研究人员介绍了一种新型的禁用EMET技术，同时举例了一些以前针对EMET的攻击方式。他们介绍的新型绕过技术主要是利用ROP技术找到DLLMain函数入口，然后实现以下代码的调用：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BOOL WINAPI DllMain (GetModuleHandleA("EMET.dll") , DLL_PROCESS_DETACH , NULL);</span><br></pre></td></tr></table></figure>
<p>EMET主要通过向保护的用户进程注入emet.dll或者emet64.dll，同时因为<code>GetModuleHandleA</code> 未被Hook，所以使用以上方法去卸载EMET.dll中的各种API Hook，虽然这不会将EMET从内存中移除，但已经足够禁用它的所有防护功能。</p>
<p><strong>【点评】</strong></p>
<p>在著名的黑客赛事Pwn2Own中，微软要求必须绕过EMET和沙盒保护攻下64位IE浏览器才算成功，因此绕过EMET成了攻破IE的必经之路。</p>
<p>不过，由于EMET并非默认在系统上开启的，需要用户自行安装，因此实际上使用EMET来保护系统软件的用户并不会太多，甚至包括一些安全人员也很少使用它，在诸多实际攻击案例中，大多不用绕过EMET就可以攻下系统。<br>
      
    </div>
    
    <footer>
      <div class="alignleft">
        <a href="/2016/09/25/BlackHat-USA-2016-议题分析/#more" class="more-link">更多内容</a>
      </div>
    </footer>
    
    <footer>
        <div class="alignright">
          
          <a href="/2016/09/25/BlackHat-USA-2016-议题分析/#comment" class="comment-link">评论</a>
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/技术分享/">技术分享</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/BlackHat/">BlackHat</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>

  </div>
</article>

<!-- 

 -->


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-16T05:54:53.000Z"><a href="/2016/09/16/fsmon-多平台文件监控工具/">2016-09-16</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/16/fsmon-多平台文件监控工具/">fsmon:多平台文件监控工具</a></h1>
  

    </header>
    <div class="entry">
      
        <p>近日在Mac上跑测试，时间一长就硬盘空间就被占用完了，几小时就生成10多G文件，导致系统卡死，程序也没法继续运行，但一直没找到生成的文件路径。<br>于是在Github上找到fsmon (<a href="https://github.com/nowsecure/fsmon" target="_blank" rel="external">https://github.com/nowsecure/fsmon</a> )这个工具，一款多平台下文件监控工具，最后终于找到生成垃圾文件的路径：<code>/private/var/folders/</code>，原来是<code>QuickLook</code>缓存文件，后面写个定时脚本清除即可。</p>
<p><img src="http://riusksk.me/media/fsmon.png" alt=""></p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="/2016/09/16/fsmon-多平台文件监控工具/#comment" class="comment-link">评论</a>
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/技术分享/">技术分享</a>
  </div>

        
        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>

  </div>
</article>

<!-- 

 -->


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-13T07:18:21.000Z"><a href="/2016/09/13/Vulnerability-War-The-Essence-of-Software-Vulnerabilities-Analysis/">2016-09-13</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/13/Vulnerability-War-The-Essence-of-Software-Vulnerabilities-Analysis/">Vulnerability War: The Essence of Software Vulnerabilities Analysis</a></h1>
  

    </header>
    <div class="entry">
      
        <p>By riusksk(@riusksk)</p>
<p>想出英文版的，但苦于目前出版社找不到译者，所以把内容简介和目录的英文版发出来给老外看，国内朋友如有有合适且有意愿的也欢迎留言！</p>
<p><img src="http://riusksk.me/media/vul_war_eng.png" alt=""></p>
<h2 id="Content-Abstract"><a href="#Content-Abstract" class="headerlink" title="Content Abstract"></a>Content Abstract</h2><p>Vulnerability War: The Essence of Software Vulnerabilities Analysis systematically explain all kinds of tools, techniques and practical methods in software vulnerability analysis and exploit, mainly related to Windows and Android platform. The book is classfied according to the different vulnerabilities, such as stack overflow, sandbox escape, types confusion, UAF , kernel vulnerability etc., at the same time, in view of the current popular mobile security, add Android platform vulnerability analysis and exploit into it. The author carefully chosen classic Vulnerabilities to share analysis techniques and tools about the cause of these vulnerabilities analysis, exploit and fix methods in detail. The biggest characteristic of this book is the actual combat based on the various types of classical vulnerabilities and discard useless theory, it’s almost “a book written out by debugger”.</p>
<p>This book is suitable for students of computer science related, somebody worked in information security, software security and mobile security related areas, software developer and hackers to read.</p>
<h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h2><h3 id="Chapter-1-Basic-Knowledge"><a href="#Chapter-1-Basic-Knowledge" class="headerlink" title="Chapter 1: Basic Knowledge"></a>Chapter 1: Basic Knowledge</h3><p>1.1 The Concepts of Vulnerability<br>1.1.1 What is The Vulnerability<br>1.1.2 The Value of Vulnerabilities<br>1.1.3 0day Vulnerability<br>1.1.4 PoC and Exploit<br>1.2 Why to analysis vunerabilities<br>1.3 The commonly analysis tools<br>1.3.1 IDA: the disassembly tool<br>1.3.2 OllyDbg: the crack and reverse analysis tool<br>1.3.3 Immunity Debugger: vulnerability analysis debugger<br>1.3.4 Windbg: Microsoft Windows Debugger<br>1.3.5 GDB: Linux Debugger<br>1.3.6 JEB: Android Decompilater<br>1.3.7 Other<br>1.4 The common vulnerability analysis method<br>1.4.1 Static analysis<br>1.4.2 Dynamic debugging<br>1.4.3 Source code analysis<br>1.4.4 Patch compare<br>1.4.5 Taint track<br>1.5 Learning resources<br>1.5.1 Some security sites<br>1.5.2 Recommended books<br>1.6 Summary<br>
      
    </div>
    
    <footer>
      <div class="alignleft">
        <a href="/2016/09/13/Vulnerability-War-The-Essence-of-Software-Vulnerabilities-Analysis/#more" class="more-link">更多内容</a>
      </div>
    </footer>
    
    <footer>
        <div class="alignright">
          
          <a href="/2016/09/13/Vulnerability-War-The-Essence-of-Software-Vulnerabilities-Analysis/#comment" class="comment-link">评论</a>
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/技术分享/">技术分享</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/书籍/">书籍</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>

  </div>
</article>

<!-- 

 -->


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-09T01:55:19.000Z"><a href="/2016/09/09/Perl-Bug-一枚/">2016-09-09</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/09/Perl-Bug-一枚/">Perl Bug 一枚</a></h1>
  

    </header>
    <div class="entry">
      
        <p><img src="http://riusksk.me/media/perl_oob.png" alt=""></p>
<p>官方回复：</p>
<p><img src="http://riusksk.me/media/perl_reply.png" alt=""></p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="/2016/09/09/Perl-Bug-一枚/#comment" class="comment-link">评论</a>
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/技术分享/">技术分享</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/Perl/">Perl</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>

  </div>
</article>

<!-- 

 -->


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-07-23T05:06:02.000Z"><a href="/2016/07/23/China-Pub计算机类图书畅销榜第一/">2016-07-23</a></time>
      
      
  
    <h1 class="title"><a href="/2016/07/23/China-Pub计算机类图书畅销榜第一/">China-Pub计算机类图书畅销榜第一</a></h1>
  

    </header>
    <div class="entry">
      
        <p><img src="http://riusksk.me/media/book_chinapub.png" alt=""></p>
<p>当初编辑联系我出书时，我就曾提前对其说过这类书籍可能受众有限，而且非入门书籍，可能销量不会太理想。</p>
<p>同时自己觉得，现在安全入门书籍，无论是web还是二进制，其实都已经足够了，没必要再写。</p>
<p>若是纯粹地追求销量，而忽略书籍的本质内容，还是太对不起自己，也对不起读者，虽然排行磅前列的几名经常被《XXX从入门到精通》给霸占着。</p>
<p>所以，出书的初衷就是记录自己学习历程中点点滴滴，也是为了备忘，算是一本写给自己的书籍。</p>
<p>出版后，内心的梗算是放下了，但还是挺忐忑的，后来一位编辑说，基本每一本书的出版都会被骂，然后我就释怀了。</p>
<p>目前，新书的销售情况还算可观，已经准备再印了，比我想像中的要好，特别感谢各位业界同行的支持！</p>
<p>当然也有一些非技术的同学也买了，只因前言中的”情怀“，也感谢这些同学的支持。</p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="/2016/07/23/China-Pub计算机类图书畅销榜第一/#comment" class="comment-link">评论</a>
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/随笔杂谈/">随笔杂谈</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/书籍/">书籍</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>

  </div>
</article>

<!-- 

 -->



<nav id="pagination">
  
  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/5/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/7/">下一页 &raquo;</a>
  </nav>

</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:riusksk.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2020/07/12/【书评】聊聊打CTF的那本书/">【书评】聊聊打CTF的那本书</a>
      </li>
    
      <li>
        <a href="/2020/06/28/信息安全从业者书单推荐（2020-6-28更新）/">信息安全从业者书单推荐（2020.6.28更新）</a>
      </li>
    
      <li>
        <a href="/2020/06/07/HITB-2020：二进制漏洞挖掘仍是会议主流方向/">HITB 2020：二进制漏洞挖掘仍是会议主流方向</a>
      </li>
    
      <li>
        <a href="/2020/05/30/谈谈追踪前沿学术研究的技巧/">谈谈追踪前沿学术研究的技巧</a>
      </li>
    
      <li>
        <a href="/2020/05/05/技术人的修炼之道：从业余到专业/">技术人的修炼之道：从业余到专业</a>
      </li>
    
      <li>
        <a href="/2020/04/11/关于Adobe-PDF-0day的故事/">关于Adobe PDF 0day的故事</a>
      </li>
    
      <li>
        <a href="/2020/03/01/持续Fuzzing在DevSecOps中的应用/">持续Fuzzing在DevSecOps中的应用</a>
      </li>
    
      <li>
        <a href="/2020/02/29/用AFL快速通关超级玛丽/">用afl玩超级玛丽：通过Fuzzing探索程序空间状态以发现更多执行路径</a>
      </li>
    
      <li>
        <a href="/2020/01/22/Fuzzing技术发展的这30年/">从研究者的视角看Fuzzing技术发展30年</a>
      </li>
    
      <li>
        <a href="/2020/01/21/Fuzzing平台建设的研究与设计-paper/">Fuzzing平台建设的研究与设计(paper)</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/技术分享/">技术分享</a><small>68</small></li>
  
    <li><a href="/categories/随笔杂谈/">随笔杂谈</a><small>27</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/0day/" style="font-size: 11.43px;">0day</a> <a href="/tags/ASLR/" style="font-size: 10px;">ASLR</a> <a href="/tags/Android/" style="font-size: 15.71px;">Android</a> <a href="/tags/Apple/" style="font-size: 10px;">Apple</a> <a href="/tags/BlackHat/" style="font-size: 12.86px;">BlackHat</a> <a href="/tags/Bochspwn/" style="font-size: 10px;">Bochspwn</a> <a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/CVE/" style="font-size: 10px;">CVE</a> <a href="/tags/CanSecWest/" style="font-size: 11.43px;">CanSecWest</a> <a href="/tags/DEP/" style="font-size: 10px;">DEP</a> <a href="/tags/EAT/" style="font-size: 10px;">EAT</a> <a href="/tags/EMET/" style="font-size: 10px;">EMET</a> <a href="/tags/Flash/" style="font-size: 14.29px;">Flash</a> <a href="/tags/Fuzzer/" style="font-size: 10px;">Fuzzer</a> <a href="/tags/Fuzzing/" style="font-size: 18.57px;">Fuzzing</a> <a href="/tags/GS/" style="font-size: 10px;">GS</a> <a href="/tags/Hacking-Team/" style="font-size: 17.14px;">Hacking Team</a> <a href="/tags/Heap-Spray/" style="font-size: 10px;">Heap Spray</a> <a href="/tags/Hook/" style="font-size: 10px;">Hook</a> <a href="/tags/MemProt/" style="font-size: 10px;">MemProt</a> <a href="/tags/OSX/" style="font-size: 12.86px;">OSX</a> <a href="/tags/PHDays/" style="font-size: 10px;">PHDays</a> <a href="/tags/Perl/" style="font-size: 11.43px;">Perl</a> <a href="/tags/SafeSEH/" style="font-size: 10px;">SafeSEH</a> <a href="/tags/Shellcode/" style="font-size: 10px;">Shellcode</a> <a href="/tags/UAF/" style="font-size: 10px;">UAF</a> <a href="/tags/UXSS/" style="font-size: 10px;">UXSS</a> <a href="/tags/Windows/" style="font-size: 11.43px;">Windows</a> <a href="/tags/XSS/" style="font-size: 10px;">XSS</a> <a href="/tags/afl/" style="font-size: 10px;">afl</a> <a href="/tags/bochspwn/" style="font-size: 10px;">bochspwn</a> <a href="/tags/fuzz/" style="font-size: 12.86px;">fuzz</a> <a href="/tags/fuzzing/" style="font-size: 11.43px;">fuzzing</a> <a href="/tags/honggfuzz/" style="font-size: 15.71px;">honggfuzz</a> <a href="/tags/iOS/" style="font-size: 11.43px;">iOS</a> <a href="/tags/macOS/" style="font-size: 10px;">macOS</a> <a href="/tags/rootkit/" style="font-size: 11.43px;">rootkit</a> <a href="/tags/shellcode/" style="font-size: 10px;">shellcode</a> <a href="/tags/v8/" style="font-size: 10px;">v8</a> <a href="/tags/winafl/" style="font-size: 10px;">winafl</a> <a href="/tags/书籍/" style="font-size: 20px;">书籍</a> <a href="/tags/信息安全/" style="font-size: 10px;">信息安全</a> <a href="/tags/内核/" style="font-size: 10px;">内核</a> <a href="/tags/写作/" style="font-size: 10px;">写作</a> <a href="/tags/历史/" style="font-size: 10px;">历史</a> <a href="/tags/威胁建模/" style="font-size: 10px;">威胁建模</a> <a href="/tags/学历/" style="font-size: 10px;">学历</a> <a href="/tags/安全大会/" style="font-size: 10px;">安全大会</a> <a href="/tags/安全审计/" style="font-size: 11.43px;">安全审计</a> <a href="/tags/安全研究/" style="font-size: 11.43px;">安全研究</a> <a href="/tags/思维导图/" style="font-size: 10px;">思维导图</a> <a href="/tags/恶意软件/" style="font-size: 11.43px;">恶意软件</a> <a href="/tags/打印机/" style="font-size: 10px;">打印机</a> <a href="/tags/攻防/" style="font-size: 10px;">攻防</a> <a href="/tags/溢出/" style="font-size: 10px;">溢出</a> <a href="/tags/漏洞/" style="font-size: 12.86px;">漏洞</a> <a href="/tags/漏洞挖掘/" style="font-size: 12.86px;">漏洞挖掘</a> <a href="/tags/监控取证/" style="font-size: 10px;">监控取证</a> <a href="/tags/程序员/" style="font-size: 10px;">程序员</a> <a href="/tags/编程/" style="font-size: 11.43px;">编程</a> <a href="/tags/编译原理/" style="font-size: 10px;">编译原理</a> <a href="/tags/职业/" style="font-size: 10px;">职业</a> <a href="/tags/虚拟机/" style="font-size: 10px;">虚拟机</a> <a href="/tags/读书/" style="font-size: 10px;">读书</a> <a href="/tags/读书笔记/" style="font-size: 10px;">读书笔记</a> <a href="/tags/逻辑/" style="font-size: 10px;">逻辑</a> <a href="/tags/黑客/" style="font-size: 10px;">黑客</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  <p>
  
  &copy; 2020 riusksk
  
  All rights reserved.</p>
  <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
  & Hosted by <a href="http://github.com" target="_blank">GitHub</a>
  <!--<span id="busuanzi_container_site_pv" >
    ，本站总访问量<span id="busuanzi_value_site_pv" ></span>次
  </span>
  -->
  </p>
</div>
<div class="clearfix"></div>

<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
</footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




<div id='bg'></div>
</body>
</html>